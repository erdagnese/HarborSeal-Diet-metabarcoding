---
title: "MiFish_classification_compare"
author: "Erin D'Agnese"
date: "2023-03-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loading libraries}
library(here)
library(rbiom)
library(tidyverse)
library(vegan)
library(janitor)
```


Now bring in all the different classifications to compare
```{r}
local_MF_tax <- read_tsv(here("data","Wild_CB_Samples","tourmaline-MiFish_CB2_12122024","02-output-dada2-pe-unfiltered","01-taxonomyLocalZG","taxonomy.tsv"))

global_MF_tax <- read_tsv(here("data","Wild_CB_Samples","tourmaline-MiFish_CB2_12122024","02-output-dada2-pe-unfiltered","01-taxonomyUniversal","taxonomy.tsv"))

local_MF_tax <- read_tsv(here("data","CorrectionBias","tourmaline-CorBias_MiFish_16072025","02-output-dada2-pe-unfiltered","01-taxonomyLocalZG","taxonomy.tsv"))

global_MF_tax <- read_tsv(here("data","CorrectionBias","tourmaline-CorBias_MiFish_16072025","02-output-dada2-pe-unfiltered","01-taxonomyUniversal","taxonomy.tsv"))
```

```{r}
local_MF_tax %>% 
  dplyr::rename("featureid"="Feature ID") -> local_MF_tax

global_MF_tax %>% 
  dplyr::rename("featureid"="Feature ID") -> global_MF_tax
```

bring in the decision function
```{r}
source(here("scripts","MiFish_Tax_compare_function.R"))
```


```{r}
mf_compare <- compare_taxonomy_tables(local_MF_tax,global_MF_tax)

mf_compare_summary <- summarize_rules(mf_compare)
mf_compare_summary
```



```{r tax comparison by hash}

mf_compare %>%
  select(featureid, final_taxonomy) -> MiFish_TaxAssign


write.table(MiFish_TaxAssign, here("intermediate-files","CorrectionBiasRun","MiFish","final_taxonomy_CorBias_MiFish.tsv"), quote=FALSE, sep='\t', col.names = TRUE, row.names = FALSE)

write.table(MiFish_TaxAssign, here("intermediate-files","Wild_CB_Samples","final_taxonomy_Wild_CB2_MiFish.tsv"), quote=FALSE, sep='\t', col.names = TRUE, row.names = FALSE)

```

